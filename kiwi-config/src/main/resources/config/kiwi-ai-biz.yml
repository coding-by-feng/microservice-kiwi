security:
  oauth2:
    client:
      client-id: ENC(wORgugqWfXlIuzbal/3pjXTNXij/RSpo)
      client-secret: ENC(rMd1buB3iI+si+W99eB+QFa3QburIEmY)
      scope: server

# 数据源
spring:
  main:
    allow-bean-definition-overriding: true
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    username: ENC(2PE/BMMoNPbRCEaIyGfcSw==)
    password: ENC(zF1rDpn+u8RZX5OTor7BpHzprZyrH+3P)
    url: jdbc:mysql://${DB_IP}:3306/kiwi_db?allowPublicKeyRetrieval=true&useUnicode=true&characterEncoding=UTF-8&useSSL=false&autoReconnect=true&serverTimezone=Pacific/Auckland
    hikari:
      connection-test-query: SELECT 1
      maximum-pool-size: 30  # Increase but within MySQL's max_connections limit
      connection-timeout: 300000  # Fail faster when connections unavailable
      idle-timeout: 300000  # Release idle connections sooner (5 minutes)
      max-lifetime: 1200000  # Shorter connection lifetime (20 minutes)
      keepalive-time: 240000  # Keep connections alive with periodic pings
      leak-detection-threshold: 300000  # Detect connection leaks  task:
    execution:
      pool:
        core-size: 1
        max-size: 1
        queue-capacity: 100
      thread-name-prefix: YTB-subtitles-thread-

management:
  health:
    elasticsearch:
      enabled: false
  endpoints:
    web:
      exposure:
        include: '*'

ignore:
  urls:
    - /actuator/**

ms:
  config:
    exclude-db: false
    exclude-cache: false

ai:
  grok:
    api:
      key: ${GROK_API_KEY}  # Replace with the actual API key
      endpoint: https://api.x.ai/v1/chat/completions  # Hypothetical endpoint
      model: "grok-4-fast-reasoning"
      thread-prompts-line-size: 400
      thread-pool-size: 8
      thread-timeout-secs: 120
  mode:
    directly-translation: "Translate the user prompt into #[TL]. Output the translation only—no labels, notes, or Markdown."
    translation-and-explanation: "Translate the user prompt into #[TL] on the first line. Then, in #[NL], give a thorough explanation covering word choice, tone/register, key grammar, and cultural/usage notes. No Markdown or extra headers."
    grammar-explanation: "Translate the user prompt into #[NL]. Then, in #[NL], explain the grammar (parts of speech, sentence structure, tense/aspect, key patterns, and tricky points). Keep it concise and clear."
    grammar-correction: "1) Provide a grammatically corrected version of the text (original language). 2) Translate the corrected text into #[NL]. 3) In #[NL], explain each correction (what changed and why). Output in that order. No extra commentary."
    vocabulary-explanation: "Explain the vocabulary item in both #[TL] and #[NL]. Provide paraphrases in both languages grouped by part of speech (verb, noun, adjective, adverb, etc.). For each part of speech, give 1–3 demo sentences in #[TL] with #[NL] translations. Skip any part of speech that does not apply."
    synonym: "List 5–8 common synonyms in #[TL]. For each, briefly explain the nuance in #[NL] and give one example sentence in #[TL] with a #[NL] translation. Output plain text only—no Markdown or extra commentary."
    antonym: "List 5–8 common antonyms in #[TL]. For each, briefly explain the nuance in #[NL] and give one example sentence in #[TL] with a #[NL] translation. Output plain text only—no Markdown or extra commentary."
    subtitle-translator: "You need to calibrate the subtitle text, because the original subtitles may lack proper punctuation. You must identify each complete subtitle sentence and add accurate punctuation, ensuring each full sentence becomes one line. For each subtitle line, output two lines: Line 1 = the original line with corrected punctuation; Line 2 = #[NL] translation. Keep the same order and number of lines as the input. No extra text, no Markdown."
    subtitle-retouch: "You need to calibrate the subtitle text, because the original subtitles may lack proper punctuation. You must identify each complete subtitle sentence and add accurate punctuation, ensuring each full sentence becomes one line. Then correct punctuation and casing. The language and number of lines must remain exactly the same as the input. Output one corrected line for each input line. No extra text, no Markdown."
    subtitle-retouch-translator: "You need to calibrate the subtitle text, because the original subtitles may lack proper punctuation. You must identify each complete subtitle sentence and add accurate punctuation, ensuring each full sentence becomes one line. For each subtitle line: Line 1 = the corrected original; Line 2 = #[TL] translation. If a line is already in #[TL], output only the corrected line (no translation line). Keep the input order. No extra text, no Markdown."
    vocabulary-association: "List as many common #[TL] words/phrases as possible that can express the user prompt’s meaning. For each item, explain nuances, register, and usage differences in #[NL]. Group closely related items when helpful. Plain text only."
    phrases-association: "List as many common #[TL] phrases as possible that can express the user prompt’s meaning. For each phrase, explain nuances, register, and usage differences in #[NL]. Group by function or context when helpful. Plain text only."
    selection-explanation: "Respond only in #[TL]. Explain the selected phrase “#[S0]” strictly based on the sentence #[S1] in 1–2 concise paragraphs. No headings, labels, English, Markdown, bullet points, or backslashes. Do not restate the full sentence; focus on meaning, nuance, tense/aspect, and function in context."
    vocabulary-character-expansion: "Verbs: v1 (#[NL] translation; #[NL] nuance), v2 (#[NL] translation; #[NL] nuance), v3 (#[NL] translation; #[NL] nuance) | Nouns: n1 (#[NL] translation; #[NL] nuance), n2 (#[NL] translation; #[NL] nuance) | Adjectives: a1 (#[NL] translation; #[NL] nuance), a2 (#[NL] translation; #[NL] nuance) | Adverbs: adv1 (#[NL] translation; #[NL] nuance), adv2 (#[NL] translation; #[NL] nuance)"
    ambiguous-association-correction: "Correction:  | Alternatives: alt1, alt2, alt3; Detect and correct misspelled or ambiguous words/phrases. Provide the corrected form and list closely related or commonly confused alternatives, all in #[TL]. If no clear correction exists, set Correction to Unknown but still list Alternatives. Plain text only."

youtube:
  api:
    # Get your API key from Google Cloud Console
    # Enable YouTube Data API v3
    key: ${YTB_API_KEY}
    base-url: https://www.googleapis.com/youtube/v3
    max-results-per-page: 50
    region-code: US
    timeout-ms: 30000
    max-videos-per-channel: 1000
    enabled: true

  oauth:
    # Optional: For caption content download
    client-id: ${YTB_OAUTH_CLIENT_ID}
    client-secret: ${YTB_OAUTH_CLIENT_SECRET}
    client-secrets-file: ${YTB_OAUTH_CLIENT_SECRETS_FILE}
    access-token: ${YTB_OAUTH_ACCESS_TOKEN}
    redirect-uri: ${GOOGLE_OAUTH2_REDIRECT_URI}
    enabled: false

  video:
    large-subtitles:
      threshold: 100

rest-template:
  http-client:
    max-total-connections: 20  # Lower for tests to reduce resource usage
    max-connections-per-route: 10
    validate-after-inactivity: 500
    connection-time-to-live: 10
  request-factory:
    connect-timeout: 100000  # Faster timeouts for tests
    read-timeout: 100000
  retry:
    max-attempts: 3  # Fewer retries for faster tests
    retryable-exceptions:
      - "me.fengorz.kiwi.common.sdk.exception.ai.GrokAiException"
      # REST Client Exceptions (General)

      - "org.springframework.web.client.RestClientException"
      - "org.springframework.web.client.ResourceAccessException"

      # HTTP Server Errors (5xx) - Usually transient
      - "org.springframework.web.client.HttpServerErrorException"

      # Network/Connection Exceptions
      - "java.net.SocketTimeoutException"
      - "java.net.ConnectException"
      - "java.net.SocketException"
      - "java.net.UnknownHostException"
      - "java.io.IOException"
      - "javax.net.ssl.SSLException"
      - "javax.net.ssl.SSLHandshakeException"
      - "org.apache.http.conn.ConnectTimeoutException"
      - "org.apache.http.conn.HttpHostConnectException"
      - "org.apache.http.NoHttpResponseException"
    backoff-period: 500  # Faster backoff for tests

# Custom async executor configuration
async:
  executor:
    thread:
      core-pool-size: 1
      max-pool-size: 1
      queue-capacity: 100
      thread-name-prefix: YTB-subtitles-thread-
      rejected-execution-policy: CALLER_RUNS  # Options: ABORT, CALLER_RUNS, DISCARD, DISCARD_OLDEST